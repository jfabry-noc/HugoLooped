<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Linux on LoopedNetwork</title>
    <link>https://looped.network/tags/linux/</link>
    <description>Recent content in Linux on LoopedNetwork</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Sat, 17 Sep 2022 18:30:30 -0400</lastBuildDate><atom:link href="https://looped.network/tags/linux/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Fixing Manjaro Linux Invalid Or Corrupt Package Error</title>
      <link>https://looped.network/posts/manjaro-invalid-corrupt-package/</link>
      <pubDate>Sat, 17 Sep 2022 18:30:30 -0400</pubDate>
      
      <guid>https://looped.network/posts/manjaro-invalid-corrupt-package/</guid>
      <description>As the title alludes to, this morning I tried updating my Pinebook Pro running Manjaro Linux through my normal method:
sudo pacman -Syu Today, this resulted in an error message about the libibus package:
 warning: could not fully load metadata for package libibus-1.5.26-2 error: failed to prepare transaction (invalid or corrupted package)
 Fun. I first wanted to see if it was really just this package that was causing the problem or if there were other issues.</description>
      <content>&lt;p&gt;As the title alludes to, this morning I tried updating my &lt;a href=&#34;https://www.pine64.org/pinebook-pro/&#34;&gt;Pinebook Pro&lt;/a&gt; running Manjaro Linux through my normal method:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo pacman -Syu
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Today, this resulted in an error message about the &lt;code&gt;libibus&lt;/code&gt; package:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;warning: could not fully load metadata for package libibus-1.5.26-2
error: failed to prepare transaction (invalid or corrupted package)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Fun. I first wanted to see if it was really &lt;em&gt;just&lt;/em&gt; this package that was causing the problem or if there were other issues. Being a &lt;code&gt;pacman&lt;/code&gt; noob, I just used the UI to mark updates to the &lt;code&gt;libibus&lt;/code&gt; package as ignored. Once I did that, all of the other packages installed successfully. This prompted for a reboot, which I gladly did since I figured I&amp;rsquo;d see if that made any difference. Once my laptop was back up and running, though, executing &lt;code&gt;pacman -Syu&lt;/code&gt; again still gave the same error related to &lt;code&gt;libibus&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Some searches online showed that a mirror with a bad package could be the problem, so I updated my mirrors via:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo pacman-mirrors -f5
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This didn&amp;rsquo;t solve the problem, but the new mirror gave me a different error message:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;error: could not open file /var/lib/pacman/local/libibus-1.5.26-2/desc&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;With some more searches online, I saw a few people on the Manjaro forums say that simply creating those files was enough to fix similar errors they had with other packages. Creating the file above just resulted in an error about a second file being missing, so I ultimately ended up running:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo touch /var/lib/pacman/local/libibus-1.5.26-2/desc
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo touch /var/lib/pacman/local/libibus-1.5.26-2/file
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now running an update allowed things to progress a little further, but I got a slew of errors complaining about &lt;code&gt;libibus&lt;/code&gt; header files (&lt;code&gt;.h&lt;/code&gt;) existing on the filesystem. My next less-than-well-thought-out idea was to just remove the package and try installing it fresh. I tried running:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo pacman -R libibus
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Fortunately, Manjaro didn&amp;rsquo;t let me do this by telling me that it was a dependency for &lt;code&gt;gnome-shell&lt;/code&gt;. Yeah, removing that would&amp;rsquo;ve been bad. It was back to searching online. The next tip I stumbled across was to try clearing the &lt;code&gt;pacman&lt;/code&gt; cache and then install updates with:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo pacman -Scc
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo pacman -Syyu
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This unfortunately gave me the same error about the header files. However, the same &lt;a href=&#34;https://forum.manjaro.org/t/cant-update-manjaro-invalid-or-corrupted-package/78802&#34;&gt;forum thread&lt;/a&gt; had another recommendation to run:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo pacman -Syyu --overwrite &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Curious about exactly what this would do prior to running it, I checked out the &lt;code&gt;man&lt;/code&gt; page for &lt;code&gt;pacman&lt;/code&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Bypass file conflict checks and overwrite conflicting files. If the package that is about to be installed contains files that are already installed and match glob, this option will cause all those files to be overwritten. Using &amp;ndash;overwrite will not allow overwriting a directory with a file or installing packages with conflicting files and directories. Multiple patterns can be specified by separating them with a comma. May be specified multiple times. Patterns can be negated, such that files matching them will not be overwritten, by prefixing them with an exclamation mark. Subsequent matches will override previous ones. A leading literal exclamation mark or backslash needs to be escaped.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I took this to mean that instead of complaining about the header files that already existed on the filesystem, it would simply overwrite them since my glob was just &lt;code&gt;*&lt;/code&gt; to match &lt;em&gt;anything&lt;/em&gt;. I ran this, and sure enough everything was fine.&lt;/p&gt;
&lt;p&gt;I mainly run Manjaro on my Pinebook Pro just because it&amp;rsquo;s such a first class citizen there with tons of support. It&amp;rsquo;s now the default when new Pinebook devices ship; back when I got mine it was still coming with Debian, though I quickly moved it over after seeing how in love the community was with Manjaro. I do find that I run into more random issues like this on Manjaro than I do with Fedora on my other laptop or Debian on my servers, for example, and at times it can be a little frustrating. I didn&amp;rsquo;t really want to spend a chunk of my Saturday morning troubleshooting this, for example. But while there seem to be more issues with Manjaro, the documentation and community are so good that usually after a little time digging in, the solution can always be found. I&amp;rsquo;ve yet to run into any issue where the &lt;a href=&#34;https://loopednetwork.medium.com/pop-os-upgrade-issues-e8bc95935ff8&#34;&gt;current installation was a lost cause&lt;/a&gt; forcing me to reinstall the operating system.&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>Compiling GSS-NTLMSSP For Alpine Linux</title>
      <link>https://looped.network/posts/gss-ntlmssp-alpine/</link>
      <pubDate>Sun, 14 Aug 2022 18:23:54 -0400</pubDate>
      
      <guid>https://looped.network/posts/gss-ntlmssp-alpine/</guid>
      <description>I recently found myself working on a project which required the GSS-NTLMSSP library. The application is going to be delivered via Kubernetes, so I needed to build a Docker image with this library. The project&amp;rsquo;s build instructions are pretty clear about what the dependencies are, but given that this was going to be a Docker image, I wanted to use Alpine Linux as the base image in order to keep the image size as small as possible.</description>
      <content>&lt;p&gt;I recently found myself working on a project which required the &lt;a href=&#34;https://github.com/gssapi/gss-ntlmssp&#34;&gt;GSS-NTLMSSP&lt;/a&gt; library. The application is going to be delivered via Kubernetes, so I needed to build a Docker image with this library. The &lt;a href=&#34;https://github.com/gssapi/gss-ntlmssp/blob/main/BUILD.txt&#34;&gt;project&amp;rsquo;s build instructions&lt;/a&gt; are pretty clear about what the dependencies are, but given that this was going to be a Docker image, I wanted to use &lt;a href=&#34;https://www.alpinelinux.org/&#34;&gt;Alpine Linux&lt;/a&gt; as the base image in order to keep the image size as small as possible. The problem with this is that Alpine is just different enough to require different dependencies, publish their &lt;a href=&#34;https://pkgs.alpinelinux.org/packages&#34;&gt;packages&lt;/a&gt; under different names, etc.&lt;/p&gt;
&lt;p&gt;I started off by just doing things manually where I fired up a local Docker container running the base &lt;a href=&#34;https://hub.docker.com/_/alpine&#34;&gt;Docker image&lt;/a&gt; and then manually installing each package via &lt;code&gt;apk add {package_name}&lt;/code&gt; to make troubleshooting easier. Once I had all of the packages from the aforementioned build documentation, I ran &lt;code&gt;./configure&lt;/code&gt;, looked at the errors, figured out which package was missing, installed it, and tried again. After several iterations of this process, &lt;code&gt;./configure&lt;/code&gt; executed successfully and it was time to attempt running &lt;code&gt;make&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;make&lt;/code&gt; ran for a minute but then would error out with:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;undefined reference to &amp;rsquo;libintl_dgettext&#39;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This seemed odd to me because while running &lt;code&gt;./configure&lt;/code&gt; I had received an error that &lt;code&gt;msgfmt&lt;/code&gt; couldn&amp;rsquo;t be found, and I had installed &lt;code&gt;gettext-dev&lt;/code&gt; in order to accommodate that. After some additional packages searches, I discovered the &lt;code&gt;musl-libintl&lt;/code&gt; library is also available. I attempted to install &lt;em&gt;that&lt;/em&gt; but received an error that it was attempting to modify a file controlled by the &lt;code&gt;gettext-dev&lt;/code&gt; package. I uninstalled that via &lt;code&gt;apk del gettext-dev&lt;/code&gt; and then ran into another error that&amp;ndash;duh&amp;ndash;&lt;code&gt;msgfmt&lt;/code&gt; was now missing again. I handled that by just installing the vanilla &lt;code&gt;gettext&lt;/code&gt; package, not the &lt;code&gt;-dev&lt;/code&gt; version, and then &lt;strong&gt;finally&lt;/strong&gt; everything compiled successfully.&lt;/p&gt;
&lt;p&gt;The following is the full list of packages that I needed in order to get the build to succeed:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;autoconf&lt;/li&gt;
&lt;li&gt;automake&lt;/li&gt;
&lt;li&gt;build-base&lt;/li&gt;
&lt;li&gt;docbook-xsl&lt;/li&gt;
&lt;li&gt;doxygen&lt;/li&gt;
&lt;li&gt;findutils&lt;/li&gt;
&lt;li&gt;gettext&lt;/li&gt;
&lt;li&gt;git&lt;/li&gt;
&lt;li&gt;krb5-dev&lt;/li&gt;
&lt;li&gt;libwbclient&lt;/li&gt;
&lt;li&gt;libtool&lt;/li&gt;
&lt;li&gt;libxml2&lt;/li&gt;
&lt;li&gt;libxslt&lt;/li&gt;
&lt;li&gt;libunistring-dev&lt;/li&gt;
&lt;li&gt;m4&lt;/li&gt;
&lt;li&gt;musl-libintl&lt;/li&gt;
&lt;li&gt;pkgconfig&lt;/li&gt;
&lt;li&gt;openssl-dev&lt;/li&gt;
&lt;li&gt;samba-dev&lt;/li&gt;
&lt;li&gt;zlib-dev&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Note that &lt;code&gt;git&lt;/code&gt; is included just to clone the repo, and &lt;code&gt;build-base&lt;/code&gt; is the meta package I used for compiling C software since just installing something like &lt;code&gt;gcc&lt;/code&gt; will not include everything needed.&lt;/p&gt;
</content>
    </item>
    
  </channel>
</rss>
